{% extends 'base.html' %}


{% block scripts %}
  <script type="text/javascript">
      $(window).on('load', function() {$('#registrationModal').modal('show')});
  </script>

  <script>
      $(document).ready(function() {
          $('#searchform').on('submit', function(e) {
              e.preventDefault(); // Предотвращаем перезагрузку страницы
              $.ajax({
                  type: 'POST',
                  url: '{% url "parser:parser" %}',
                  data: $(this).serialize(),
                  success: function (task) {
                      $('#id_link').val('');
                      localStorage.setItem('taskid', task.id);
                      addTaskToList(task);
                  },
                  error: function(xhr, status, error) {
                      console.error('Ошибка при загрузке:', error);
                  },
                  timeout: 10000
              });
          });
      });

      function addTaskToList(task) {
          const listItem = `
              <li>
                  <a class="list-group-item" href="${task.absolute_url}">
                      <div class="d-flex w-100 align-items-center justify-content-between">
                          <strong class="mb-1 text-truncate">${task.name}</strong>
                          <small>${task.created}</small>
                      </div>
                      <div class="d-flex w-100 align-items-center justify-content-between">
                          <small>${task.description}</small>
                      </div>
                  </a>
              </li>
          `;
          $('#sidebarComponents').prepend(listItem);
      };
  </script>
{% endblock %}